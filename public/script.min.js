angular.module("admin",[]),angular.module("users",["ngFileUpload"]),angular.module("admin").factory("Authentication",[function(){return this.user=window.user,{user:this.user}}]),angular.module("users").factory("Authentication",[function(){return this.user=window.user,{user:this.user}}]),angular.module("users").factory("Photos",["$resource",function(e){return e("api/photos/:photoId",{userId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").directive("ngFileSelect",["fileReader","$timeout",function(e,o){return{scope:{ngModel:"="},link:function(s,n){function r(n){e.readAsDataUrl(n,s).then(function(e){o(function(){s.ngModel=e})})}n.bind("change",function(e){r((e.srcElement||e.target).files[0])})}}}]),angular.module("users").factory("fileReader",["$q","$log",function(e,o){var s=function(e,o,s){return function(){s.$apply(function(){o.resolve(e.result)})}},n=function(e,o,s){return function(){s.$apply(function(){o.reject(e.result)})}},r=function(e,o){return function(e){o.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}},t=function(e,o){var t=new FileReader;return t.onload=s(t,e,o),t.onerror=n(t,e,o),t.onprogress=r(0,o),t};return{readAsDataUrl:function(o,s){var n=e.defer();return t(n,s).readAsDataURL(o),n.promise}}}]),angular.module("users").factory("Users",["$resource",function(e){return e("api/user/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]),angular.module("admin").config(["$routeProvider","$locationProvider",function(e,o){e.when("/_admin",{templateUrl:"admin/views/admin.client.view.html"}),o.html5Mode(!0)}]),angular.module("users").config(["$routeProvider","$locationProvider",function(e,o){e.when("/",{templateUrl:"users/views/users.client.view.html"}).when("/signin",{templateUrl:"users/views/usersSignin.client.view.html"}).when("/user/:userId",{templateUrl:"users/views/otherusers.client.view.html"}).when("/searchuser",{templateUrl:"users/views/searchuser.client.view.html"}).when("/signup",{templateUrl:"users/views/usersSignup.client.view.html"}).when("/signout",{templateUrl:"users/views/usersSignout.client.view.html"}).otherwise({redirectTo:"/"}),o.html5Mode(!0)}]),angular.module("admin").controller("adminController",["$scope","Authentication","$location","$routeParams","$http",function(e,o,s,n,r){e.authentication=o,e.giveAdmin={add:function(){var o={id:e.giveAdmin.id};r.post("api/_admin/giveAdmin",o).then(function(e){console.log("suc")},function(o){console.log("fail"),e.error=errorResponse.data.message})},erase:function(){var o={id:e.giveAdmin.id};r.post("api/_admin/eraseAdmin",o).then(function(o){console.log("suc"),alert(e.giveAdmin.id+" admin added"),e.giveAdmin.id=""},function(o){console.log("fail"),e.error=errorResponse.data.message})},id:""},e.showusers={init:function(){e.showusers.users=[],r.post("api/_admin/getusers").then(function(o){console.log("users get"),console.log(o.data),e.showusers.users=o.data},function(o){e.error=errorResponse.data.message})}},e.initFunctions={showusers:function(){e.showusers.init()}}}]),angular.module("users").controller("UsersController",["$scope","Authentication","$location","$routeParams","$http","fileReader","Upload","$window","Users","Photos",function(e,o,s,n,r,t,a,i,u,l){e.authentication=o,e.signin=function(){var o={username:this.username,password:this.password};r.post("api/getuser",o).then(function(n){console.log(n),e.signin.userid=n.data[0].id,r.post("api/signin",o).then(function(e){s.path("/"),window.location.reload("/"),console.log(e)},function(o){console.log("wrong"),e.error=errorResponse.data.message})},function(o){console.log("error happened"),e.error=errorResponse.data.message})},e.signout=function(){var o={firstname:this.firstname,lastname:this.lastname,email:this.email,username:this.username,password:this.password};r.post("api/signout",o).then(function(e){window.location.reload("/"),s.path("/")},function(o){e.error=errorResponse.data.message})},e.signup=function(){var o={firstname:this.firstname,lastname:this.lastname,email:this.email,username:this.username,password:this.password,role:["user"]};r.post("api/signup",o).then(function(e){window.location.reload("/"),s.path("/")},function(o){e.error=errorResponse.data.message})},e.otheruser={init:function(){e.otheruser._id=n.userId;var o={_id:e.otheruser._id};r.post("api/getOtheruser",o).then(function(o){e.otheruser.username=o.data[0].username},function(o){console.log("error happened"),e.error=errorResponse.data.message})},showphotos:{temp:[],show:function(){e.uploadphotos.file="";var o={id:e.otheruser._id};r.post("api/showphotos",o).then(function(o){console.log(o.data),e.showphotos.temp=o.data},function(o){e.error=errorResponse.data.message})}}},e.searchuser={init:function(){e.searchuser.searchname="",e.searchuser.searchresult=[]},search:function(){var o={searchname:e.searchuser.searchname};e.searchuser.searchresult=[],r.post("api/searchuser",o).then(function(o){e.searchuser.searchresult=o.data},function(o){console.log("error happened"),e.error=errorResponse.data.message})}},e.uploadphotos={submit:function(){e.upload_form.file.$valid&&e.uploadphotos.file&&e.uploadphotos.upload(e.uploadphotos.file)},upload:function(o){a.upload({url:"/api/upload",data:{file:o,username:e.authentication.user}}).then(function(o){e.showphotos.show(),0===o.data.error_code?console.log("Success "+o.config.data.file.name+"uploaded. Response: "):console.log("an error occured")},function(e){console.log("Error status: "+e.status),i.alert("Error status: "+e.status)},function(o){console.log(o);var s=parseInt(100*o.loaded/o.total);console.log("progress: "+s+"% "+o.config.data.file.name),e.uploadphotos.progress="progress: "+s+"% "})}},e.showphotos={temp:[],show:function(){e.uploadphotos.file="";var o={id:e.authentication.user._id};r.post("api/showphotos",o).then(function(o){console.log(o.data),e.showphotos.temp=o.data},function(o){e.error=errorResponse.data.message})}},e.photohandler={delete:function(o){var s={photoid:o};r.post("api/photos/"+o,s).then(function(o){console.log(o.data),console.log(e.showphotos.temp);for(var s=0;s<e.showphotos.temp.length;s++)e.showphotos.temp[s]._id===o.data._id&&e.showphotos.temp.splice(s,1),console.log(s)},function(o){console.log("error happened"),e.error=errorResponse.data.message})}},e.initFunctions={userpage:function(){e.showphotos.show()},otheruser:function(){e.otheruser.init(),e.otheruser.showphotos.show()},searchuser:function(){e.searchuser.init()}}}]);