angular.module("admin",[]),angular.module("chat",[]),angular.module("users",["ngFileUpload"]),angular.module("admin").factory("Authentication",[function(){return this.user=window.user,{user:this.user}}]),angular.module("chat").factory("Authentication",[function(){return this.user=window.user,{user:this.user}}]),angular.module("chat").factory("Chats",["$resource",function(e){return e("api/chat/room/:Id",{Id:"@_id"},{update:{method:"PUT"}})}]),angular.module("chat").factory("mySocket",function(e){return e()}),angular.module("users").factory("Authentication",[function(){return this.user=window.user,{user:this.user}}]),angular.module("users").factory("Photos",["$resource",function(e){return e("api/photos/:photoId",{userId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),angular.module("users").directive("ngFileSelect",["fileReader","$timeout",function(e,t){return{scope:{ngModel:"="},link:function(o,n){n.bind("change",function(n){!function(n){e.readAsDataUrl(n,o).then(function(e){t(function(){o.ngModel=e})})}((n.srcElement||n.target).files[0])})}}}]),angular.module("users").factory("fileReader",["$q","$log",function(e,t){return{readAsDataUrl:function(t,o){var n=e.defer();return function(e,t){var o=new FileReader;return o.onload=function(e,t,o){return function(){o.$apply(function(){t.resolve(e.result)})}}(o,e,t),o.onerror=function(e,t,o){return function(){o.$apply(function(){t.reject(e.result)})}}(o,e,t),o.onprogress=function(e,t){return function(e){t.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}}(0,t),o}(n,o).readAsDataURL(t),n.promise}}}]),angular.module("users").factory("Users",["$resource",function(e){return e("api/user/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]),angular.module("admin").config(["$routeProvider","$locationProvider",function(e,t){e.when("/_admin",{templateUrl:"admin/views/admin.client.view.html"}),t.html5Mode(!0)}]),angular.module("chat").config(["$routeProvider","$locationProvider",function(e,t){e.when("/chat",{templateUrl:"chat/views/chat.client.view.html"}).when("/chat/chatList",{templateUrl:"chat/views/chatList.client.view.html"}),t.html5Mode(!0)}]),angular.module("users").config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"users/views/users.client.view.html"}).when("/signin",{templateUrl:"users/views/usersSignin.client.view.html"}).when("/user/:userId",{templateUrl:"users/views/otherusers.client.view.html"}).when("/searchuser",{templateUrl:"users/views/searchuser.client.view.html"}).when("/signup",{templateUrl:"users/views/usersSignup.client.view.html"}).when("/signout",{templateUrl:"users/views/usersSignout.client.view.html"}).when("/cart",{templateUrl:"users/views/cart.client.view.html"}).when("/album",{templateUrl:"users/views/album.client.view.html"}),t.html5Mode(!0)}]),angular.module("admin").controller("adminController",["$scope","Authentication","$location","$routeParams","$http",function(e,t,o,n,r){e.authentication=t,e.giveAdmin={add:function(){var t={id:e.giveAdmin.id};r.post("api/_admin/giveAdmin",t).then(function(e){console.log("suc")},function(t){console.log("fail"),e.error=errorResponse.data.message})},erase:function(){var t={id:e.giveAdmin.id};r.post("api/_admin/eraseAdmin",t).then(function(t){console.log("suc"),alert(e.giveAdmin.id+" admin added"),e.giveAdmin.id=""},function(t){console.log("fail"),e.error=errorResponse.data.message})},id:""},e.showusers={init:function(){e.showusers.users=[],r.post("api/_admin/getusers").then(function(t){console.log("users get"),console.log(t.data),e.showusers.users=t.data},function(t){e.error=errorResponse.data.message})}},e.initFunctions={showusers:function(){e.showusers.init()}}}]),angular.module("chat").controller("chatController",["$scope","Authentication","$location","$routeParams","$http",function(e,t,o,n,r){e.authentication=t,e.chatList={getList:function(){var t={username:e.authentication.user.username};r.post("api/chat/chatList",t).then(function(t){e.chatList.list=t.data},function(t){e.error=errorResponse.data.message})},redirect:function(t){r.get("/api/chat/room/"+t).then(function(e){o.path("/chat/room/"+t),window.location.reload("/chat/room/"+t)},function(t){e.error=errorResponse.data.message})}},e.initFunctions={chatList:function(){e.chatList.getList()}}}]),angular.module("users").controller("UsersController",["$scope","Authentication","$location","$routeParams","$http","fileReader","Upload","$window","Users","Photos",function(e,t,o,n,r,a,s,i,u,c){e.authentication=t,e.signin=function(){var t={username:this.username,password:this.password};r.post("api/getuser",t).then(function(n){console.log(n),e.signin.userid=n.data[0].id,r.post("api/signin",t).then(function(e){o.path("/"),window.location.reload("/"),console.log(e)},function(t){console.log("wrong"),e.error=errorResponse.data.message})},function(t){console.log("error happened"),e.error=errorResponse.data.message})},e.signout=function(){var t={firstname:this.firstname,lastname:this.lastname,email:this.email,username:this.username,password:this.password};r.post("api/signout",t).then(function(e){window.location.reload("/"),o.path("/")},function(t){e.error=errorResponse.data.message})},e.signup=function(){var t={firstname:this.firstname,lastname:this.lastname,email:this.email,username:this.username,password:this.password,role:["user"]};r.post("api/signup",t).then(function(e){window.location.reload("/"),o.path("/")},function(t){e.error=errorResponse.data.message})},e.otheruser={init:function(){e.otheruser._id=n.userId;var t={_id:e.otheruser._id};r.post("api/getOtheruser",t).then(function(t){e.otheruser.username=t.data[0].username},function(t){console.log("error happened"),e.error=errorResponse.data.message})},showphotos:{temp:[],show:function(){e.uploadphotos.file="";var t={id:e.otheruser._id};r.post("api/showphotos",t).then(function(t){console.log(t.data),e.showphotos.temp=t.data},function(t){e.error=errorResponse.data.message})}}},e.searchuser={init:function(){e.searchuser.searchname="",e.searchuser.searchresult=[]},search:function(){var t={searchname:e.searchuser.searchname};e.searchuser.searchresult=[],r.post("api/searchuser",t).then(function(t){e.searchuser.searchresult=t.data},function(t){console.log("error happened"),e.error=errorResponse.data.message})}},e.uploadphotos={submit:function(){e.upload_form.file.$valid&&e.uploadphotos.file&&e.uploadphotos.upload(e.uploadphotos.file)},upload:function(t){console.log(t),s.upload({url:"/api/upload",data:{file:t,username:e.authentication.user}}).then(function(t){e.showphotos.show(),0===t.data.error_code?console.log("Success "+t.config.data.file.name+"uploaded. Response: "):console.log("an error occured")},function(e){console.log("Error status: "+e.status),i.alert("Error status: "+e.status)},function(t){console.log(t);var o=parseInt(100*t.loaded/t.total);console.log("progress: "+o+"% "+t.config.data.file.name),e.uploadphotos.progress="progress: "+o+"% "})}},e.showphotos={temp:[],show:function(){e.uploadphotos.file="";var t={id:e.authentication.user._id};r.post("api/showphotos",t).then(function(t){console.log(t.data),e.showphotos.temp=t.data},function(t){e.error=errorResponse.data.message})}},e.photohandler={delete:function(t){console.log(t);var o={photoid:t};r.post("api/photos/"+t,o).then(function(t){for(var o=0;o<e.showphotos.temp.length;o++)e.showphotos.temp[o].info._id===t.data._id&&e.showphotos.temp.splice(o,1)},function(t){console.log("error happened"),e.error=errorResponse.data.message})}},e.cart={init:function(){r.get("api/addToCart").then(function(t){e.cart.items=t.data.items},function(t){e.error=errorResponse.data.message})},addToCart:function(t){r.post("api/addToCart",t).then(function(t){console.log(t.data.items),e.cart.items=t.data.items},function(t){e.error=errorResponse.data.message})},deleteFromCart:function(t){var o={photoid:t};r.post("api/deleteFromCart",o).then(function(t){e.cart.items=t.data.items},function(t){e.error=errorResponse.data.message})},submitCart:function(){var t={albumname:e.cart.albumname};r.post("api/submitCart",t).then(function(t){console.log("submit success"),e.cart.init(),alert("submit success"),o.path("/"),window.location.reload("/")},function(t){e.error=errorResponse.data.message})}},e.albumpage={init:function(){r.get("api/getAlbum").then(function(t){e.albumpage.albums=t.data,console.log(t.data)},function(t){e.error=errorResponse.data.message})},showphotos:function(t){e.albumpage.imgs=e.albumpage.albums[t].img},deleteAlbum:function(t){var o={id:e.albumpage.albums[t]._id};console.log(e.albumpage.albums[t]),r.post("api/deleteAlbum",o).then(function(o){console.log(o.data),alert("delete"+e.albumpage.albums[[t]].name),e.albumpage.albums.splice(t,1)},function(t){e.error=errorResponse.data.message})}},e.chat={otherUrlDirect:function(){var t,n=e.authentication.user,a={id:e.otheruser};r.post("/api/chat/getChatPatner",a).then(function(a){t=a.data[0],n.created>t.created?e.chat.roomId=n._id+"-"+t._id:e.chat.roomId=t._id+"-"+n._id,r.get("/api/chat/room/"+e.chat.roomId).then(function(t){o.path("/chat/room/"+e.chat.roomId),window.location.reload("/chat/room/"+e.chat.roomId)},function(t){e.error=errorResponse.data.message})},function(t){e.error=errorResponse.data.message})}},e.initFunctions={userpage:function(){e.showphotos.show(),e.cart.addToCart()},otheruser:function(){e.cart.init(),e.otheruser.init(),e.otheruser.showphotos.show()},searchuser:function(){e.searchuser.init()},cart:function(){e.cart.init()},albumpage:function(){e.albumpage.init()}}}]);