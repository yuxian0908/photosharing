angular.module("users",["ngFileUpload"]),angular.module("users").factory("Authentication",[function(){return this.user=window.user,{user:this.user}}]),angular.module("users").directive("ngFileSelect",["fileReader","$timeout",function(e,n){return{scope:{ngModel:"="},link:function(o,s){function t(s){e.readAsDataUrl(s,o).then(function(e){n(function(){o.ngModel=e})})}s.bind("change",function(e){t((e.srcElement||e.target).files[0])})}}}]),angular.module("users").factory("fileReader",["$q","$log",function(e,n){var o=function(e,n,o){return function(){o.$apply(function(){n.resolve(e.result)})}},s=function(e,n,o){return function(){o.$apply(function(){n.reject(e.result)})}},t=function(e,n){return function(e){n.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}},i=function(e,n){var i=new FileReader;return i.onload=o(i,e,n),i.onerror=s(i,e,n),i.onprogress=t(0,n),i};return{readAsDataUrl:function(n,o){var s=e.defer();return i(s,o).readAsDataURL(n),s.promise}}}]),angular.module("users").factory("Users",["$resource",function(e){return e("api/_admin/signin/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$routeProvider","$locationProvider",function(e,n){e.when("/_admin",{templateUrl:"users/views/users.client.view.html"}).when("/_admin/signin",{templateUrl:"users/views/usersSignin.client.view.html"}).when("/_admin/signin/:userId",{templateUrl:"users/views//users.client.view.html"}).when("/_admin/signup",{templateUrl:"users/views/usersSignup.client.view.html"}).when("/_admin/signout",{templateUrl:"users/views/usersSignout.client.view.html"}),n.html5Mode(!0)}]),angular.module("users").controller("UsersController",["$scope","Authentication","$location","$routeParams","$http","fileReader","Upload","$window","Users",function(e,n,o,s,t,i,r,a,u){e.authentication=n,e.signin=function(){var n=new u({username:this.username,password:this.password});t.post("api/_admin/getuser",n).then(function(n){e.signin.userid=n.data[0].id},function(n){console.log("error happened"),e.error=errorResponse.data.message}),n.$save(function(n){o.path("/_admin/signin/"+e.signin.userid),window.location.reload("/_admin/signin/"+e.signin.userid)},function(n){e.error=n.data.message})},e.signout=function(){var n={firstname:this.firstname,lastname:this.lastname,email:this.email,username:this.username,password:this.password};t.post("api/_admin/signout",n).then(function(e){window.location.reload("/_admin"),o.path("/_admin")},function(n){e.error=errorResponse.data.message})},e.signup=function(){var n={firstname:this.firstname,lastname:this.lastname,email:this.email,username:this.username,password:this.password,imgAry:[]};t.post("api/_admin/signup",n).then(function(e){window.location.reload("/_admin"),o.path("/_admin")},function(n){e.error=errorResponse.data.message})},e.showphotos={temp:[],show:function(){e.uploadphotos.file="";var n={id:e.authentication.user._id};t.post("api/_admin/showphotos",n).then(function(n){console.log(n.data[0].imgAry),e.showphotos.temp=n.data[0].imgAry,console.log(e.showphotos.temp)},function(n){e.error=errorResponse.data.message})}},e.uploadphotos={submit:function(){e.upload_form.file.$valid&&e.uploadphotos.file&&e.uploadphotos.upload(e.uploadphotos.file)},upload:function(n){r.upload({url:"/api/_admin/upload",data:{file:n,username:e.authentication.user}}).then(function(n){e.showphotos.show(),0===n.data.error_code?console.log("Success "+n.config.data.file.name+"uploaded. Response: "):console.log("an error occured")},function(e){console.log("Error status: "+e.status),a.alert("Error status: "+e.status)},function(n){console.log(n);var o=parseInt(100*n.loaded/n.total);console.log("progress: "+o+"% "+n.config.data.file.name),e.uploadphotos.progress="progress: "+o+"% "})}},e.initFunctions=function(){e.showphotos.show()}}]);