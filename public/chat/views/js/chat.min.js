$(function(){var e=io();$(document).ready(function(){var e=document.location.pathname.match(/[^\/]+$/)[0];$.ajax({url:"/chat/get_chatters",type:"POST",dataType:"json",data:{room:e,username:user.username},success:function(e){console.log(e),console.log("現在有"+e.length+"人")}})}),$(document).ready(function(){var e=document.location.pathname.match(/[^\/]+$/)[0];$.ajax({url:"/chat/get_messages",type:"POST",dataType:"json",data:{room:e,username:user.username},success:function(e){for(var a=0;a<e.length;a++)$("#messages").append($("<li>").text(e[a].sender+" : "+e[a].message));console.log(e),console.log("現在有"+e.length+"則對話")}})}),$(document).ready(function(){var e=document.location.pathname.match(/[^\/]+$/)[0];console.log(e),$.ajax({url:"/chat/join",type:"POST",dataType:"json",data:{username:user.username,room:e},success:function(e){console.log(e),console.log(user.username+"加入房間")}})}),$("#submitMessage").submit(function(){var a=user.username,s=$("#message").val(),n=document.location.pathname.match(/[^\/]+$/)[0];$.ajax({url:"/chat/send_message",type:"POST",dataType:"json",data:{username:a,message:s,room:n},success:function(n){"OK"==n.status&&(e.emit("chat message",{username:a,message:s}),$("#message").val(""))}})}),e.on("chat message",function(e){$("#messages").append($("<li>").text(e.username+" : "+e.message))}),e.emit("join",user.username),e.on("joined",function(e,a){$("#messages").append($("<li>").text(e))})});