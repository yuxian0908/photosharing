$(function(){var e=io();$(document).ready(function(){var e=document.location.pathname.match(/[^\/]+$/)[0];$.ajax({url:"/chat/get_messages",type:"POST",dataType:"json",data:{room:e,username:user.username},success:function(e){for(var s=0;s<e.length;s++)$("#messages").append($("<li>").text(e[s].sender+" : "+e[s].message));console.log(e),console.log("現在有"+e.length+"則對話")}})}),$("#submitMessage").submit(function(){var s=user.username,a=$("#message").val(),n=document.location.pathname.match(/[^\/]+$/)[0];$.ajax({url:"/chat/send_message",type:"POST",dataType:"json",data:{username:s,message:a,room:n},success:function(n){"OK"==n.status&&(e.emit("chat message",{username:s,message:a}),$("#message").val(""))}})}),e.on("chat message",function(e){$("#messages").append($("<li>").text(e.username+" : "+e.message))}),e.emit("join",user.username),e.on("joined",function(e,s){$("#messages").append($("<li>").text(e))})});